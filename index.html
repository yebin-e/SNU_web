<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>서울시 공공도서관 시각화</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/d3-cloud/build/d3.layout.cloud.js"></script>
    <!-- 경계선 데이터는 seoul_boundaries.geojson 로컬 파일로 사용합니다. -->
    <!-- Kakao Maps SDK -->
    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=cbf0a2c8e6044d1dd06fc9d73ce57a40&autoload=false&libraries=clusterer"></script>
</head>
<body>
    
    
    <!-- 인트로 화면 -->
    <div id="introScreen" class="intro-screen">
        <!-- 시네마틱 레이어 (이미지 파일은 img/modern-library-night.png, img/cozy-library.png 경로에 두세요) -->
        <div class="cine-bg cine-bg-1" aria-hidden="true"></div>
        <div class="cine-bg cine-bg-2" aria-hidden="true"></div>
        <div class="float-icons" aria-hidden="true"></div>
        <div class="rings3d" aria-hidden="true">
            <div class="ring ring-0"></div>
            <div class="ring ring-1"></div>
            <div class="ring ring-2"></div>
        </div>
        <div class="mouse-gradient-overlay" aria-hidden="true"></div>
        <div class="intro-content">
            <div class="intro-logo">
                <svg class="library-icon" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <!-- 도서관 기둥들 -->
                    <rect x="60" y="120" width="20" height="280" fill="currentColor"/>
                    <rect x="120" y="120" width="20" height="280" fill="currentColor"/>
                    <rect x="180" y="120" width="20" height="280" fill="currentColor"/>
                    <rect x="240" y="120" width="20" height="280" fill="currentColor"/>
                    <rect x="300" y="120" width="20" height="280" fill="currentColor"/>
                    <rect x="360" y="120" width="20" height="280" fill="currentColor"/>
                    <rect x="420" y="120" width="20" height="280" fill="currentColor"/>
                    
                    <!-- 지붕/삼각형 -->
                    <path d="M40 120 L256 40 L472 120 L40 120 Z" fill="currentColor"/>
                    
                    <!-- 바닥/기단 -->
                    <rect x="20" y="400" width="472" height="30" fill="currentColor"/>
                    <rect x="10" y="430" width="492" height="20" fill="currentColor"/>
                    
                    <!-- 입구/문 -->
                    <rect x="220" y="300" width="72" height="100" fill="rgba(255,255,255,0.3)"/>
                    
                    <!-- 계단 -->
                    <rect x="180" y="380" width="152" height="20" fill="currentColor"/>
                    <rect x="160" y="390" width="192" height="10" fill="currentColor"/>
                    
                    <!-- 도서관 상단 장식 -->
                    <rect x="50" y="100" width="412" height="20" fill="currentColor"/>
                </svg>
            </div>
            <h1 class="intro-title">책 한 권과 쉼을 누리세요</h1>
            <p class="intro-subtitle">서울에서 나만의 도서관 찾아보기</p>
            <div class="scroll-indicator">
                <span>아래로 스크롤하세요</span>
                <div class="scroll-arrow">⇣</div>
            </div>
        </div>
    </div>

    <!-- 중간 화면 -->
    <div id="middleScreen" class="middle-screen">
        <div class="middle-content">
            <div class="middle-logo">
                <svg class="search-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 21L16.514 16.506M19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <h1 class="middle-title">서울의 모든 도서관을 한눈에</h1>
            <p class="middle-subtitle">원하는 서비스를 선택해주세요</p>
            
            <!-- 메뉴 버튼들 -->
            <div class="menu-buttons">
                <button class="menu-btn" id="mainPageBtn">
                    <div class="menu-icon">🏛️</div>
                    <div class="menu-text">메인화면 접속</div>
                    <div class="menu-desc">도서관 검색 및 정보 조회</div>
                </button>
                
                <button class="menu-btn" id="childrenPageBtn">
                    <div class="menu-icon">👶</div>
                    <div class="menu-text">어린이 이용정보 한눈에 보기</div>
                    <div class="menu-desc">어린이 친화적인 도서관 정보</div>
                </button>
                
                <button class="menu-btn" id="genrePageBtn">
                    <div class="menu-icon">📚</div>
                    <div class="menu-text">장르별 한눈에 보기</div>
                    <div class="menu-desc">도서 장르별 이용 현황 정보</div>
                </button>
            </div>
        </div>
    </div>
  
    <!-- 장르별 한눈에 보기 페이지 -->
    <div id="genrePage" class="genre-page" style="display: none;">
        <div class="genre-content">
            <header class="genre-header">
                <button class="back-btn" id="backToMiddleFromGenre">← 돌아가기</button>
                <h1>📚 장르별 한눈에 보기</h1>
            </header>
            
            <div class="genre-main">
                <div class="info-section">
                    <h2>🎨 도서 장르별 이용 현황</h2>
                    <p>서울시 도서관의 장르별 도서 이용 현황을 시각적으로 확인해보세요.</p>
                </div>
                
                
                <!-- 새로운 랭킹 시스템 -->
                <div class="advanced-rankings">
                    <div class="ranking-category">
                        <h3>🇰🇷 국내서 장르별 랭킹</h3>
                        <div class="ranking-tabs">
                            <button class="ranking-tab active" data-type="domestic" data-genre="total">전체</button>
                            <button class="ranking-tab" data-type="domestic" data-genre="총류">총류</button>
                            <button class="ranking-tab" data-type="domestic" data-genre="철학">철학</button>
                            <button class="ranking-tab" data-type="domestic" data-genre="사회과학">사회과학</button>
                            <button class="ranking-tab" data-type="domestic" data-genre="문학">문학</button>
                        </div>
                        <div class="ranking-list" id="domesticRankingList"></div>
                    </div>
                    
                    <div class="ranking-category">
                        <h3>🌍 국외서 장르별 랭킹</h3>
                        <div class="ranking-tabs">
                            <button class="ranking-tab active" data-type="foreign" data-genre="total">전체</button>
                            <button class="ranking-tab" data-type="foreign" data-genre="총류">총류</button>
                            <button class="ranking-tab" data-type="foreign" data-genre="철학">철학</button>
                            <button class="ranking-tab" data-type="foreign" data-genre="사회과학">사회과학</button>
                            <button class="ranking-tab" data-type="foreign" data-genre="문학">문학</button>
                        </div>
                        <div class="ranking-list" id="foreignRankingList"></div>
                    </div>
                    
                    <div class="ranking-category">
                        <h3>👶 인쇄자료 연령대별 랭킹</h3>
                        <div class="ranking-tabs">
                            <button class="ranking-tab active" data-type="print" data-age="어린이">어린이</button>
                            <button class="ranking-tab" data-type="print" data-age="청소년">청소년</button>
                            <button class="ranking-tab" data-type="print" data-age="성인">성인</button>
                        </div>
                        <div class="ranking-list" id="printAgeRankingList"></div>
                    </div>
                    
                    <div class="ranking-category">
                        <h3>💻 전자자료 연령대별 랭킹</h3>
                        <div class="ranking-tabs">
                            <button class="ranking-tab active" data-type="electronic" data-age="어린이">어린이</button>
                            <button class="ranking-tab" data-type="electronic" data-age="청소년">청소년</button>
                            <button class="ranking-tab" data-type="electronic" data-age="성인">성인</button>
                        </div>
                        <div class="ranking-list" id="electronicAgeRankingList"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 어린이 정보 페이지 -->
    <div id="childrenPage" class="children-page" style="display: none;">
        <div class="children-content">
            <header class="children-header">
                <button class="back-btn" id="backToMiddle">← 돌아가기</button>
                <h1>👶 어린이 이용정보 한눈에 보기</h1>
            </header>
            
            <div class="children-main">
                <div class="info-section">
                    <h2>🎨 어린이 친화적인 도서관</h2>
                    <p>어린이실을 보유하고 어린이 도서가 풍부한 도서관들을 소개합니다.</p>
                </div>
                

                
                <div class="children-library-section">
                    <h3>🌟 어린이 도서를 많이 보유한 도서관 Top 10</h3>
                    <div class="children-library-list" id="childrenLibraryList">
                        <div id="childrenLibraryContainer"></div>
                    </div>
                </div>
                
                <div class="children-recommendation-section">
                    <h3>🎯 어린이 도서관 활용 추천</h3>
                    <p>어린이 도서 보유량과 대출수를 기준으로 도서관을 2가지 유형으로 분류합니다.</p>
                    
                    <div class="recommendation-categories">
                        <div class="recommendation-category" onclick="showQuietLibraries()">
                            <div class="category-icon">📚</div>
                            <div class="category-info">
                                <h4>대출이 여유로운 도서관</h4>
                                <p>어린이 도서를 많이 보유하고 대출수가 적어 즉시 이용하기 좋은 도서관</p>
                            </div>
                        </div>
                        <div class="recommendation-category" onclick="showPopularLibraries()">
                            <div class="category-icon">⭐</div>
                            <div class="category-info">
                                <h4>인기 많은 도서관</h4>
                                <p>어린이 도서를 많이 보유하고 대출수도 많아 다양한 자료를 제공하는 도서관</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recommendation-results" id="recommendationResults" style="display: none;">
                        <div class="results-header">
                            <h4 id="resultsTitle"></h4>
                            <button class="close-results" onclick="closeRecommendationResults()">✕</button>
                        </div>
                        <div class="results-list" id="resultsList"></div>
                    </div>
                </div>
                
                <div class="children-genre-section">
                    <h3>📊 어린이 인쇄자료 장르별 대출 랭킹 Top 10</h3>
                    <div class="genre-ranking-container">
                        <div class="genre-tabs" id="genreTabs">
                            <button class="genre-tab active" data-genre="total">전체</button>
                            <button class="genre-tab" data-genre="총류">총류</button>
                            <button class="genre-tab" data-genre="철학">철학</button>
                            <button class="genre-tab" data-genre="종교">종교</button>
                            <button class="genre-tab" data-genre="사회과학">사회과학</button>
                            <button class="genre-tab" data-genre="순수과학">순수과학</button>
                            <button class="genre-tab" data-genre="기술과학">기술과학</button>
                            <button class="genre-tab" data-genre="예술">예술</button>
                            <button class="genre-tab" data-genre="언어">언어</button>
                            <button class="genre-tab" data-genre="문학">문학</button>
                            <button class="genre-tab" data-genre="역사">역사</button>
                        </div>
                        <div class="genre-ranking-list" id="genreRankingList">
                            <!-- 장르별 랭킹이 여기에 표시됩니다 -->
                        </div>
                    </div>
                </div>
                

                
                <div class="children-map-section">
                    <h3>📍 어린이 친화 도서관 위치</h3>
                    <div class="children-map-container">
                        <div id="childrenMapContainer"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- 헤더 -->
        <header class="header">
            <div class="header-top">
                <button class="back-btn main-back-btn" id="backToMenu" style="display: none;">← 메뉴로 돌아가기</button>
                <h1>📚 서울시 공공도서관 정보</h1>
            </div>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="도서관명 또는 지역을 검색하세요...">
                <button id="searchBtn">검색</button>
            </div>
                        <div class="category-bar">
                <div class="category-group">
                    <div class="category-title">도서 종류</div>
                    <!-- 1단계: 국내서/국외서 선택 -->
                    <div class="category-level-1">
                        <div class="category-chips" id="bookTypeChips">
                            <button class="chip primary-chip" data-type="bookType" data-value="domestic">국내서</button>
                            <button class="chip primary-chip" data-type="bookType" data-value="foreign">국외서</button>
                        </div>
                    </div>
                    <!-- 2단계: 세부 분류 선택 -->
                    <div class="category-level-2" id="bookSubcategoryContainer" style="display: none;">
                        <div class="category-chips" id="bookCategoryChips">
                            <button class="chip secondary-chip" data-type="book" data-value="총류">총류</button>
                            <button class="chip secondary-chip" data-type="book" data-value="철학">철학</button>
                            <button class="chip secondary-chip" data-type="book" data-value="종교">종교</button>
                            <button class="chip secondary-chip" data-type="book" data-value="사회과학">사회과학</button>
                            <button class="chip secondary-chip" data-type="book" data-value="순수과학">순수과학</button>
                            <button class="chip secondary-chip" data-type="book" data-value="기술과학">기술과학</button>
                            <button class="chip secondary-chip" data-type="book" data-value="예술">예술</button>
                            <button class="chip secondary-chip" data-type="book" data-value="언어">언어</button>
                            <button class="chip secondary-chip" data-type="book" data-value="문학">문학</button>
                            <button class="chip secondary-chip" data-type="book" data-value="역사">역사</button>
                        </div>
                    </div>
                </div>
                <div class="category-group">
                    <div class="category-title">전자자료</div>
                    <div class="category-chips" id="electronicCategoryChips">
                        <button class="chip" data-type="electronic" data-value="전자저널">전자저널</button>
                        <button class="chip" data-type="electronic" data-value="전자도서">전자도서</button>
                        <button class="chip" data-type="electronic" data-value="오디오북">오디오북</button>
                        <button class="chip" data-type="electronic" data-value="웹데이터베이스">웹데이터베이스</button>
                        <button class="chip" data-type="electronic" data-value="기타">기타</button>
                    </div>
                </div>
                <div class="category-group">
                    <div class="category-title">좌석혼잡도</div>
                    <div class="category-chips" id="studyCategoryChips">
                        <button class="chip" data-type="study" data-value="매우혼잡">매우 혼잡</button>
                        <button class="chip" data-type="study" data-value="혼잡">혼잡</button>
                        <button class="chip" data-type="study" data-value="보통">보통</button>
                        <button class="chip" data-type="study" data-value="여유">여유</button>
                    </div>
                </div>
                <div class="category-group">
                    <div class="category-title">쾌적함</div>
                    <div class="category-chips" id="comfortCategoryChips">
                        <button class="chip" data-type="comfort" data-value="매우좋음">매우 쾌적함</button>
                        <button class="chip" data-type="comfort" data-value="좋음">쾌적함</button>
                        <button class="chip" data-type="comfort" data-value="보통">보통</button>
                        <button class="chip" data-type="comfort" data-value="좁음">좁음</button>
                    </div>
                </div>
            </div>
        </header>

        <!-- 메인 콘텐츠 -->
        <main class="main-content">
            <!-- 지도 영역 (플레이스홀더) -->
            <div class="map-container">
                <div id="map"></div>
            </div>

            <!-- 사이드바 -->
            <aside class="sidebar">
                <div class="sidebar-card">
                    <div class="sidebar-header">
                        <h3>도서관 목록</h3>
                        <div class="filter-controls">
                            <select id="districtFilter">
                                <option value="">전체 구</option>
                                <option value="강남구">강남구</option>
                                <option value="강동구">강동구</option>
                                <option value="강북구">강북구</option>
                                <option value="강서구">강서구</option>
                                <option value="관악구">관악구</option>
                                <option value="광진구">광진구</option>
                                <option value="구로구">구로구</option>
                                <option value="금천구">금천구</option>
                                <option value="노원구">노원구</option>
                                <option value="도봉구">도봉구</option>
                                <option value="동대문구">동대문구</option>
                                <option value="동작구">동작구</option>
                                <option value="마포구">마포구</option>
                                <option value="서대문구">서대문구</option>
                                <option value="서초구">서초구</option>
                                <option value="성동구">성동구</option>
                                <option value="성북구">성북구</option>
                                <option value="송파구">송파구</option>
                                <option value="양천구">양천구</option>
                                <option value="영등포구">영등포구</option>
                                <option value="용산구">용산구</option>
                                <option value="은평구">은평구</option>
                                <option value="종로구">종로구</option>
                                <option value="중구">중구</option>
                                <option value="중랑구">중랑구</option>
                            </select>
                            <select id="sortSelect" class="sort-select">
                                <option value="">정렬 없음</option>
                                <option value="holdingsDesc">보유도서 많은 순</option>
                                <option value="visitorsDesc">방문자 많은 순</option>
                                <option value="loansDesc">대출 많은 순</option>
                                <option value="seatsDesc">좌석 많은 순</option>
                                <option value="areaDesc">면적 큰 순</option>
                                <option value="yearDesc">개관년도 최신 순</option>
                                <option value="yearAsc">개관년도 오래된 순</option>
                            </select>
                        </div>
                        <div class="age-filter-section">
                            <select id="ageFocus" class="age-select">
                                <option value="">연령대 집중 없음</option>
                                <option value="child">어린이 이용 많음</option>
                                <option value="teen">청소년 이용 많음</option>
                                <option value="adult">성인 이용 많음</option>
                            </select>
                        </div>
                    </div>

                    <div class="library-list" id="libraryList">
                        <div class="library-list-inner" id="libraryListInner"></div>
                    </div>
                </div>
            </aside>
        </main>

        <!-- 상세 정보 모달 -->
        <div id="detailModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <div id="modalContent"></div>
            </div>
        </div>
    </div>

    <script src="map.js"></script>
    <script src="script.js"></script>
</body>
</html>
